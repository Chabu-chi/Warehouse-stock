<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ç‡∏≠‡∏á‡πÉ‡∏ô‡∏Ñ‡∏•‡∏±‡∏á</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js"></script>
  <style>
    #stockDisplay {
      display: grid;
      grid-template-columns: repeat(10, 1fr);
      gap: 10px;
      margin-top: 20px;
    }
    #stockDisplay button {
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      background: #f9f9f9;
      cursor: pointer;
      transition: 0.2s;
      white-space: pre-line;
    }
    #stockDisplay button:hover {
      background: #d1f0ff;
    }
    #summary {
      margin-top: 20px;
      font-weight: bold;
      font-size: 18px;
    }
    #soldItems {
      margin-top: 20px;
      padding: 10px;
      border: 2px solid red;
      border-radius: 8px;
      background: #ffe5e5;
    }
    #soldList span {
      display: inline-block;
      margin: 3px;
      padding: 5px 8px;
      border-radius: 5px;
      background: #fff0f0;
      border: 1px solid #ff9999;
    }
    #soldList button {
      margin-left: 5px;
      padding: 2px 6px;
      border: none;
      background: #ff6666;
      color: white;
      border-radius: 4px;
      cursor: pointer;
    }
    #soldList button:hover {
      background: #cc0000;
    }
    #resetBtn {
      margin-top: 20px;
      padding: 10px 20px;
      border-radius: 8px;
      border: none;
      background: #ffcccc;
      cursor: pointer;
      font-weight: bold;
    }
    #resetBtn:hover {
      background: #ff9999;
    }
  </style>
</head>
<body>
  <h1>üì¶ ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ç‡∏≠‡∏á‡πÉ‡∏ô‡∏Ñ‡∏•‡∏±‡∏á (‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå)</h1>
  <p>‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ ‡∏à‡∏∞‡∏•‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏•‡∏á</p>
  <div id="stockDisplay"></div>
  <div id="summary"></div>
  <button id="resetBtn" onclick="resetStock()">‚ôªÔ∏è ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ï‡πá‡∏≠‡∏Å</button>
  <div id="soldItems"><b>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢‡πÑ‡∏õ:</b> <div id="soldList">-</div></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyCPUvQKdqnZKXkHfUkvE-V-UAEyy3lJjT4",
    authDomain: "warehouse-stock-d6531.firebaseapp.com",
    databaseURL: "https://warehouse-stock-d6531-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "warehouse-stock-d6531",
    storageBucket: "warehouse-stock-d6531.firebasestorage.app",
    messagingSenderId: "604093665937",
    appId: "1:604093665937:web:148107aba120fb63e52530",
    measurementId: "G-561KL8VG5W"
  };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    let stock = {};
    let sold = [];

    const stockRef = ref(db, "stock");
    const soldRef = ref(db, "sold");

    onValue(stockRef, (snapshot) => {
      stock = snapshot.val() || {};
      renderStock();
    });

    onValue(soldRef, (snapshot) => {
      sold = snapshot.val() || [];
      renderSold();
    });

    function renderStock() {
      let display = document.getElementById("stockDisplay");
      let summary = document.getElementById("summary");
      display.innerHTML = "";
      let codes = Object.keys(stock).sort();
      let totalRemain = 0;

      for (let code of codes) {
        if (stock[code] > 0) {
          let btn = document.createElement("button");
          btn.innerText = `${code}\n(${stock[code]})`;
          btn.onclick = function () { sellItem(code); };
          display.appendChild(btn);
          totalRemain += stock[code];
        }
      }
      summary.innerText = `‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${totalRemain} ‡∏ä‡∏¥‡πâ‡∏ô`;
    }

    function renderSold() {
      let soldList = document.getElementById("soldList");
      soldList.innerHTML = "";
      if (sold.length === 0) {
        soldList.innerText = "-";
        return;
      }

      sold.forEach((code, index) => {
        let span = document.createElement("span");
        span.innerText = code;
        let removeBtn = document.createElement("button");
        removeBtn.innerText = "x";
        removeBtn.onclick = function () { removeSold(index); };
        span.appendChild(removeBtn);
        soldList.appendChild(span);
      });
    }

    function sellItem(code) {
      if (stock[code] > 0) {
        stock[code] -= 1;
        set(stockRef, stock);
        sold.push(code);
        set(soldRef, sold);
      }
    }

    function removeSold(index) {
      let code = sold[index];
      // ‡∏Ñ‡∏∑‡∏ô‡∏Ç‡∏≠‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤ stock 1 ‡∏ä‡∏¥‡πâ‡∏ô
      stock[code] = (stock[code] || 0) + 1;
      set(stockRef, stock);
      // ‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ sold
      sold.splice(index, 1);
      set(soldRef, sold);
    }

    window.resetStock = function() {
      let init = {};
      for (let i = 0; i < 100; i++) {
        let code = i.toString().padStart(2, "0");
        init[code] = 1;
      }
      set(stockRef, init);
      set(soldRef, []);
    }
  </script>
</body>
</html>
